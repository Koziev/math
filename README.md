# Шаблонизатор для генерации синтетических диалогов

Выразительные средства шаблонизатора позволяют генерировать связные и лексически вариативные
диалоги разной длины для экспериментов с моделями вопросно-ответных систем. Я использую этот движок
для генерации школьных задач по математике с разбором ответов.

Шаблонизатор позволяет использовать обычные выражения на Питоне для вычисления фрагментов, заполняющих слоты,
а также реализовывать базовую логику ветвления, чтобы формировать последовательности реплик, учитывающие
результаты вычислений. Например, вместо выдачи "У медведя осталось 0 шишек" с помощью оператора ветвления
можно сформировать более типичное для русской речи высказывание "У медведя не осталось шишек".

Движок содержит несколько встроенных механизмов для склонения существительных и словосочетаний, чтобы
обеспечить согласование количества предметов с числительным по правилам русского языка. Это снимает с
писателя шаблонов необходимость учитывать такие рутинные нюансы.

К примеру, шаблон [template_math_3.json](https://github.com/Koziev/math/blob/main/data/math/template_math_3.json) раскрывается
в такие диалоги.

Сэмпл 1:
```
У Ольги было 4 ягоды. Сколько их у нее осталось после того, как она отдала 4 ягоды?
4-4=0. Ни одной ягоды у Ольги не осталось.
```

Сэмпл 2:
```
У Вали сначала было 8 морковок, потом она 3 штуки отдала. Сколько морковок у нее осталось?
8-3=5. У Вали осталось 5 морковок.
```

Сэмпл 3:
```
У Полины сначала было 6 морковок, потом она 4 штуки отдала. Сколько морковок у нее осталось?
6-4=2, значит морковок у нее осталось 2 штуки.
```


# Синтаксис шаблонов

В [подкаталоге data](https://github.com/Koziev/math/tree/main/data/math) есть примеры шаблонов.
Файлы шаблонов должны в названии иметь префикс "template".
Каждый такой файл в формате JSON содержит один шаблон.

Разберем самый простой пример шаблона:

```
{
 "variables":
 {
  "sbj": "random.choice(fnames)",
  "x1": "random.randint(3, 10)",
  "x2": "random.randint(3, 10)",
  "z": "x1+x2",
  "figures": "['треугольник', 'круг', 'овал', 'четырехугольник', 'пятиугольник', 'шестиугольник', 'семиугольник', 'ромб', 'параллелограмм']",
  "fig1": "random.choice(figures)",
  "fig2": "random.choice(figures)",
  "verb": "'⦃нарисовала|изобразила|начертила⦄'"
 },
 
 "constraints":
 [
  "fig1 != fig2"
 ],
 
 "dialogue":
 [
  "{sbj} {verb} {x1} {numcor(x1, fig1, 'Acc')} и {x2} {numcor(x2, fig2, 'Acc')}. Сколько всего фигур она {verb}?",
  "{x1}+{x2}={z}. Всего {sbj} {verb} {z} {numcor(z, 'фигура', 'Acc')}"
 ]
}
```

*** TODO ***
